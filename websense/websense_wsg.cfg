# Alienvault plugin
# Author: Balazs Makany  Modified Bjorn Hovd
# Plugin websense id:19004 version: 0.2.0
# Last modification: 2015-04-29
#
# Accepted products:
# Websense - Websense Web Filter, Web Security, Web Security Gateway, and Web Security  Gateway Anywhere, v7.6 - 7.8, V-Series Appliances, v7.6 - 7.8
# SIEM Integration set to "syslog/key-value pairs (Splunk and others) format"
# Link for translation codes hxxp://www.websense.com/content/support/library/web/v76/siem/siem.pdf
# Description:  This plugin intends to parse the syslog messages generated by the supported Websense products.
#                               Note that you might need to tweak your categories. Also, Websense tends to add or remove categories, so please check periodically !
#                              
# Created by : Balazs Makany
#
 
 
 
[DEFAULT]
plugin_id=19004
 
[config]
type=detector
enable=yes
source=log
location=/var/log/websense_wsg.log
create_file=false
 
process=syslog
start=no  
stop=no
startup=
shutdown=
 
#Translation will be used to transform the regular category into the category that signifies that it was blocked.
#Eg.: ID 1 (Adult Material) is still going to be 1 if it is permitted, but will transform to 10001 if blocked.
#Categories
 
[translation]
1=10001
2=10002
3=10003
4=10004
5=10005
6=10006
7=10007
8=10008
9=10009
10=10010
11=10011
12=10012
13=10013
14=10014
15=10015
16=10016
17=10017
18=10018
19=10019
20=10020
21=10021
22=10022
23=10023
24=10024
25=10025
26=10026
27=10027
28=10028
29=10029
64=10064
65=10065
66=10066
67=10067
68=10068
69=10069
70=10070
72=10072
73=10073
74=10074
75=10075
76=10076
78=10078
79=10079
80=10080
81=10081
82=10082
83=10083
84=10084
85=10085
86=10086
87=10087
88=10088
89=10089
90=10090
91=10091
92=10092
93=10093
94=10094
95=10095
96=10096
97=10097
98=10098
99=10099
100=10100
101=10101
102=10102
103=10103
107=10107
108=10108
109=10109
110=10110
111=10111
112=10112
113=10113
114=10114
115=10115
116=10116
117=10117
118=10118
121=10121
122=10122
123=10123
124=10124
125=10125
126=10126
128=10128
138=10138
146=10146
147=10147
148=10148
149=10149
150=10150
151=10151
152=10152
153=10153
154=10154
156=10156
164=10164
166=10166
167=10167
172=10172
191=10191
192=10192
193=10193
194=10194
195=10195
196=10196
200=10200
201=10201
202=10202
203=10203
204=10204
205=10205
206=10206
207=10207
208=10208
209=10209
210=10210
211=10211
212=10212
213=10213
214=10214
215=10215
216=10216
217=10217
218=10218
219=10219
1500=11500
1501=11501
1502=11502
1503=11503
1504=11504
1505=11505
1506=11506
1507=11507
1508=11508
1509=11509
1510=11510
1511=11511
1512=11512
1513=11513
1514=11514
1516=11516
1517=11517
1518=11518
1519=11519
1520=11520
1521=11521
1523=11523
1524=11524
1525=11525
1526=11526
1527=11527
1528=11528
1529=11529
1530=11530
1531=11531
1801=11801
1900=11900
1901=11901
1902=11902
1903=11903
1904=11904
1905=11905
1906=11906
1907=11907
1908=11908
1909=11909
 
#Dispositions
1024=Permitted: Category permitted, not set
1025=Blocked: Category blocked
1026=Permitted: Category permitted
1027=Blocked: Custom URL, category blocked
1028=Permitted: Custom URL, category permitted
1029=Blocked: Always blocked
1030=Permitted: Never blocked
1031=Blocked: Blocked by limited access filter
1032=Blocked: Blocked by keyword
1033=Blocked: Blocked – subscription level exceeded
1034=Permitted: Permitted – subscription level exceeded
1035=Blocked: Password override page
1037=Permitted: Permitted by password override
1040=Permitted: Permitted with Confirm option
1041=Blocked: Blocked – authentication required
1042=Permitted: Permitted – category not purchased
1043=Permitted: Permitted by quota
1044=Permitted: Permitted with keyword match
1045=Blocked: Blocked due to network bandwidth
1046=Blocked: Blocked due to protocol bandwidth
1047=Blocked: File type blocked
1048=Permitted: File type permitted
1049=Blocked: Protocol blocked
1050=Permitted: Protocol permitted
1051=Permitted: Protocol permitted, not set
1052=Permitted: Permitted by limited access filter
1053=Blocked: Redirected by search filtering
1054=Blocked: Blocked with Confirm option
1055=Blocked: Blocked by quota
1056=Permitted: Permitted – protocol not purchased
1057=Blocked: Blocked by security override
1058=Blocked: Blocked by hybrid antivirus scanning (inbound)
1059=Blocked: Blocked by hybrid antivirus scanning (outbound)
1060=Permitted: Permitted by exception
1061=Blocked: Blocked by exception
1281=Blocked: Category blocked (Content Gateway analysis)
1282=Permitted: Category permitted (Content Gateway analysis)
1293=Permitted: Permitted by password override (Content Gateway analysis)
1296=Permitted: Permitted with confirm option (Content Gateway analysis)
1299=Permitted: Permitted by quota (Content Gateway analysis)
1301=Blocked: Blocked due to network bandwidth (Content Gateway analysis)
1302=Blocked: Blocked due to protocol bandwidth (Content Gateway analysis)
1303=Blocked: File type blocked (Content Gateway analysis)
1304=Permitted: File type permitted (Content Gateway analysis)
1310=Blocked: Blocked with confirm option (Content Gateway analysis)
1311=Blocked: Blocked by quota (Content Gateway analysis)
1313=Blocked: Blocked by security override (Content Gateway analysis)
1537=Permitted: Permitted by scanning link analysis
1538=Permitted: Web 2.0 request permitted
1539=Permitted: Permitted after Web 2.0 scanning and link analysis
1553=Blocked: Blocked by scanning link analysis
1554=Blocked: Web 2.0 request blocked
1555=Blocked: Blocked after Web 2.0 scanning and link analysis
1556=Permitted: Zipbomb permitted (Content Gateway analysis)
1557=Blocked: Zipbomb blocked (Content Gateway analysis)
 
 
[ 0001 Websense - Permitted against intentions ]
event_type=event
regexp="(?P<datesyslog>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+\S+\s+vendor=Websense\s+product=\w+\s+product_version=\d+.\d+.\d+\saction=permitted\s+severity=(\d+)\s+category=(?P<categ>1|15|19|22|24|26|64|65|66|67|95|100|115|152|212)\s+user=(.+(?!src_host))\s+src_host=(?P<src_h>\d+.\d+.\d+.\d+)\s+src_port=(?P<src_p>\d+)\s+dst_host=(?P<dst>\S+)\sdst_ip=(?P<dst_i>\d+.\d+.\d+.\d+)\s+dst_port=(?P<dst_p>\d+)\s+bytes_out=\d+\s+bytes_in=\d+\shttp_response=\d+\s+http_method=\S+\s+http_content_type=\S+\s+http_user_agent=(?P<udata1>\S+)\s+http_proxy_status_code=\d+\s+reason=(?P<udata2>\S+)\s+disposition=(?P<udata3>\d+)\s+policy=(?P<udata4>\S+)\s+role=\d+\s+duration=\d+\s+url=(?P<udata5>\S+)"
date={normalize_date($datesyslog)}
plugin_sid={$categ}
src_ip={$src_h}
src_port={$src_p}
dst_ip={$dst_i}
dst_port={$dst_p}
userdata1={$udata1}
userdata2={$udata2}
userdata3={translate($udata3)}
userdata4={$udata4}
userdata5={$udata5}
userdata6={$dst}
 
 
[ 0002 Websense - Permitted dangerous cyber security specific content]
event_type=event
regexp="(?P<datesyslog>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+\S+\s+vendor=Websense\s+product=\w+\s+product_version=\d+.\d+.\d+\saction=permitted\s+severity=(\d+)\s+category=(?P<categ>75|80|126|128|138|154|164|166|167|172|191|192|193|194|200|205|206|207|213|214|215|216|217|218|219|1801|1900|1902)\s+user=(.+(?!src_host))\s+src_host=(?P<src_h>\d+.\d+.\d+.\d+)\s+src_port=(?P<src_p>\d+)\s+dst_host=(?P<dst>\S+)\sdst_ip=(?P<dst_i>\d+.\d+.\d+.\d+)\s+dst_port=(?P<dst_p>\d+)\s+bytes_out=\d+\s+bytes_in=\d+\shttp_response=\d+\s+http_method=\S+\s+http_content_type=\S+\s+http_user_agent=(?P<udata1>\S+)\s+http_proxy_status_code=\d+\s+reason=(?P<udata2>\S+)\s+disposition=(?P<udata3>\d+)\s+policy=(?P<udata4>\S+)\s+role=\d+\s+duration=\d+\s+url=(?P<udata5>\S+)"
date={normalize_date($datesyslog)}
plugin_sid={$categ}
src_ip={$src_h}
src_port={$src_p}
dst_ip={$dst_i}
dst_port={$dst_p}
userdata1={$udata1}
userdata2={$udata2}
userdata3={translate($udata3)}
userdata4={$udata4}
userdata5={$udata5}
userdata6={$dst}
 
[ 0003 Websense - Permitted but undetermined or company-dependent]
event_type=event
regexp="(?P<datesyslog>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+\S+\s+vendor=Websense\s+product=\w+\s+product_version=\d+.\d+.\d+\saction=permitted\s+severity=(\d+)\s+category=(?P<categ>25|90|113|153|156)\s+user=(.+(?!src_host))\s+src_host=(?P<src_h>\d+.\d+.\d+.\d+)\s+src_port=(?P<src_p>\d+)\s+dst_host=(?P<dst>\S+)\sdst_ip=(?P<dst_i>\d+.\d+.\d+.\d+)\s+dst_port=(?P<dst_p>\d+)\s+bytes_out=\d+\s+bytes_in=\d+\shttp_response=\d+\s+http_method=\S+\s+http_content_type=\S+\s+http_user_agent=(?P<udata1>\S+)\s+http_proxy_status_code=\d+\s+reason=(?P<udata2>\S+)\s+disposition=(?P<udata3>\d+)\s+policy=(?P<udata4>\S+)\s+role=\d+\s+duration=\d+\s+url=(?P<udata5>\S+)"
date={normalize_date($datesyslog)}
plugin_sid={$categ}
src_ip={$src_h}
src_port={$src_p}
dst_ip={$dst_i}
dst_port={$dst_p}
userdata1={$udata1}
userdata2={$udata2}
userdata3={translate($udata3)}
userdata4={$udata4}
userdata5={$udata5}
userdata6={$dst}
 
[ 0900 Websense - Blocked but dangerous categories ]
event_type=event
regexp="(?P<datesyslog>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+\S+\s+vendor=Websense\s+product=\w+\s+product_version=\d+.\d+.\d+\saction=blocked\s+severity=(\d+)\s+category=(?P<categ>1|15|19|22|24|25|26|64|65|66|67|75|80|90|95|113|115|126|128|152|153|154|156|164|166|167|172|191|192|193|194|205|206|207|212|213|214|215|216|217|218|219|1801|1900|1902)\s+user=(.+(?!src_host))\s+src_host=(?P<src_h>\d+.\d+.\d+.\d+)\s+src_port=(?P<src_p>\d+)\s+dst_host=(?P<dst>\S+)\sdst_ip=(?P<dst_i>\d+.\d+.\d+.\d+)\s+dst_port=(?P<dst_p>\d+)\s+bytes_out=\d+\s+bytes_in=\d+\shttp_response=\d+\s+http_method=\S+\s+http_content_type=\S+\s+http_user_agent=(?P<udata1>\S+)\s+http_proxy_status_code=\d+\s+reason=(?P<udata2>\S+)\s+disposition=(?P<udata3>\d+)\s+policy=(?P<udata4>\S+)\s+role=\d+\s+duration=\d+\s+url=(?P<udata5>\S+)"
date={normalize_date($datesyslog)}
plugin_sid={translate($categ)}
src_ip={$src_h}
src_port={$src_p}
dst_ip={$dst_i}
dst_port={$dst_p}
userdata1={$udata1}
userdata2={$udata2}
userdata3={translate($udata3)}
userdata4={$udata4}
userdata5={$udata5}
userdata6={$dst}
 
[ 0901 Websense - Blocked but dangerous cyber security specific content]
event_type=event
regexp="(?P<datesyslog>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s+\S+\s+vendor=Websense\s+product=\w+\s+product_version=\d+.\d+.\d+\saction=blocked\s+severity=(\d+)\s+category=(?P<categ901>75|80|126|128|138|154|164|166|167|172|191|192|193|194|200|205|206|207|213|214|215|216|217|218|219|1801|1900|1902)\s+user=(.+(?!src_host))\s+src_host=(?P<src_h>\d+.\d+.\d+.\d+)\s+src_port=(?P<src_p>\d+)\s+dst_host=(?P<dst>\S+)\sdst_ip=(?P<dst_i>\d+.\d+.\d+.\d+)\s+dst_port=(?P<dst_p>\d+)\s+bytes_out=\d+\s+bytes_in=\d+\shttp_response=\d+\s+http_method=\S+\s+http_content_type=\S+\s+http_user_agent=(?P<udata1>\S+)\s+http_proxy_status_code=\d+\s+reason=(?P<udata2>\S+)\s+disposition=(?P<udata3>\d+)\s+policy=(?P<udata4>\S+)\s+role=\d+\s+duration=\d+\s+url=(?P<udata5>\S+)"
date={normalize_date($datesyslog)}
plugin_sid={translate($categ901)}
src_ip={$src_h}
src_port={$src_p}
dst_ip={$dst_i}
dst_port={$dst_p}
userdata1={$udata1}
userdata2={$udata2}
userdata3={translate($udata3)}
userdata4={$udata4}
userdata5={$udata5}
userdata6={$dst}